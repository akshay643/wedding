"use strict";(()=>{var e={};e.id=1051,e.ids=[1051],e.modules={9993:e=>{e.exports=require("googleapis")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},7985:(e,t,o)=>{o.r(t),o.d(t,{config:()=>p,default:()=>l,routeModule:()=>c});var a={};o.r(a),o.d(a,{config:()=>d,default:()=>handler});var r=o(1802),s=o(7153),i=o(6249),n=o(9993);async function handler(e,t){if("GET"!==e.method)return t.status(405).json({error:"Method not allowed"});let{fileId:o,fileName:a}=e.query;if(!o)return t.status(400).json({error:"File ID is required"});try{let e=new n.google.auth.GoogleAuth({credentials:{type:"service_account",project_id:process.env.GOOGLE_PROJECT_ID,private_key_id:process.env.GOOGLE_PRIVATE_KEY_ID,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n"),client_email:process.env.GOOGLE_CLIENT_EMAIL,client_id:process.env.GOOGLE_CLIENT_ID,auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://oauth2.googleapis.com/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:`https://www.googleapis.com/robot/v1/metadata/x509/${process.env.GOOGLE_CLIENT_EMAIL}`},scopes:["https://www.googleapis.com/auth/drive.readonly"]}),r=n.google.drive({version:"v3",auth:e}),s=await r.files.get({fileId:o,fields:"name, mimeType, size"}),i=await r.files.get({fileId:o,alt:"media"},{responseType:"stream"}),d=a||s.data.name||"wedding-photo.jpg",l=s.data.mimeType||"image/jpeg";t.setHeader("Content-Disposition",`attachment; filename="${d}"`),t.setHeader("Content-Type",l),t.setHeader("Cache-Control","no-cache"),s.data.size&&t.setHeader("Content-Length",s.data.size),i.data.pipe(t)}catch(e){if(console.error("Download error:",e),404===e.code)return t.status(404).json({error:"File not found"});if(403===e.code)return t.status(403).json({error:"Access denied. File may be private."});return t.status(500).json({error:"Failed to download file",details:e.message})}}let d={api:{responseLimit:"50mb"}},l=(0,i.l)(a,"default"),p=(0,i.l)(a,"config"),c=new r.PagesAPIRouteModule({definition:{kind:s.x.PAGES_API,page:"/api/download",pathname:"/api/download",bundlePath:"",filename:""},userland:a})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),o=t.X(0,[4222],()=>__webpack_exec__(7985));module.exports=o})();