"use strict";(()=>{var e={};e.id=112,e.ids=[112],e.modules={9993:e=>{e.exports=require("googleapis")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6362:(e,t,r)=>{r.r(t),r.d(t,{config:()=>p,default:()=>h,routeModule:()=>f});var s={};r.r(s),r.d(s,{default:()=>u});var i=r(1802),a=r(7153),n=r(6249);let{google:o}=r(9993),{checkAuth:l}=r(9823),d=new o.auth.GoogleAuth({credentials:{type:"service_account",project_id:process.env.GOOGLE_PROJECT_ID,private_key_id:process.env.GOOGLE_PRIVATE_KEY_ID,private_key:process.env.GOOGLE_PRIVATE_KEY?.replace(/\\n/g,"\n"),client_email:process.env.GOOGLE_CLIENT_EMAIL,client_id:process.env.GOOGLE_CLIENT_ID,auth_uri:"https://accounts.google.com/o/oauth2/auth",token_uri:"https://oauth2.googleapis.com/token",auth_provider_x509_cert_url:"https://www.googleapis.com/oauth2/v1/certs",client_x509_cert_url:`https://www.googleapis.com/robot/v1/metadata/x509/${process.env.GOOGLE_CLIENT_EMAIL}`},scopes:["https://www.googleapis.com/auth/drive.file"]}),c=o.drive({version:"v3",auth:d});async function ensureWishesFile(){try{let e="Wedding_Wishes.txt",t=process.env.WEDDING_FOLDER_ID;if(!t||"your-wedding-folder-id"===t)throw Error("WEDDING_FOLDER_ID not configured in environment variables");let r=await c.files.list({q:`name='${e}' and parents in '${t}' and trashed=false`,fields:"files(id, name)"});if(r.data.files.length>0)return r.data.files[0].id;let s=`Wedding Wishes for Akshay & Tripti
========================================
Date: ${new Date().toLocaleDateString()}

`,i=await c.files.create({resource:{name:e,parents:[t]},media:{mimeType:"text/plain",body:s},fields:"id"});return i.data.id}catch(e){throw console.error("Error ensuring wishes file:",e),e}}async function appendWishToFile(e,t,r,s){try{let i=await c.files.get({fileId:e,alt:"media"}),a=i.data||"",n=`
---
From: ${t}
Date: ${new Date(s).toLocaleString()}
Wish: ${r}

`;return await c.files.update({fileId:e,media:{mimeType:"text/plain",body:a+n}}),!0}catch(e){throw console.error("Error appending wish to file:",e),e}}async function getAllWishes(){try{let e=process.env.WEDDING_FOLDER_ID;if(!e||"your-wedding-folder-id"===e)throw Error("WEDDING_FOLDER_ID not configured in environment variables");let t=await c.files.list({q:`name='Wedding_Wishes.txt' and parents in '${e}' and trashed=false`,fields:"files(id, name)"});if(0===t.data.files.length)return[];let r=await c.files.get({fileId:t.data.files[0].id,alt:"media"}),s=r.data||"",i=[],a=s.split("---").slice(1);return a.forEach(e=>{let t=e.trim().split("\n");if(t.length>=3){let e=t[0].match(/From: (.+)/),r=t[1].match(/Date: (.+)/),s=t[2].match(/Wish: (.+)/);e&&r&&s&&i.push({guestName:e[1],timestamp:r[1],wish:s[1]})}}),i.reverse()}catch(e){return console.error("Error getting wishes:",e),[]}}async function handler(e,t){let{authenticated:r,user:s}=l(e);if(!r)return t.status(401).json({success:!1,error:"Authentication required"});try{if("POST"===e.method){let{guestName:r,wish:s,timestamp:i}=e.body;if(!r||!s)return t.status(400).json({success:!1,error:"Guest name and wish are required"});let a=await ensureWishesFile();return await appendWishToFile(a,r,s,i),t.status(200).json({success:!0,message:"Wish submitted successfully"})}if("GET"!==e.method)return t.status(405).json({success:!1,error:"Method not allowed"});{let e=await getAllWishes();return t.status(200).json({success:!0,wishes:e})}}catch(e){return console.error("Wishes API error:",e),t.status(500).json({success:!1,error:"Internal server error"})}}let u=handler,h=(0,n.l)(s,"default"),p=(0,n.l)(s,"config"),f=new i.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/wishes",pathname:"/api/wishes",bundlePath:"",filename:""},userland:s})}};var t=require("../../webpack-api-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),r=t.X(0,[4222,9823],()=>__webpack_exec__(6362));module.exports=r})();