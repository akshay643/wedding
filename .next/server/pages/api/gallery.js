"use strict";(()=>{var e={};e.id=200,e.ids=[200],e.modules={9993:e=>{e.exports=require("googleapis")},9344:e=>{e.exports=require("jsonwebtoken")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2781:e=>{e.exports=require("stream")},5379:(e,i,r)=>{r.r(i),r.d(i,{config:()=>m,default:()=>u,routeModule:()=>p});var t={};r.r(t),r.d(t,{default:()=>handler});var n=r(1802),o=r(7153),a=r(6249);let{initializeGoogleDrive:s}=r(3545),{checkAuth:l}=r(9823),d={mehndi:process.env.MEHNDI_FOLDER_ID,haldi:process.env.HALDI_FOLDER_ID,"dj-night":process.env.DJ_NIGHT_FOLDER_ID,wedding:process.env.WEDDING_FOLDER_ID};async function handler(e,i){try{let{authenticated:r}=l(e);if(!r)return i.status(401).json({error:"Authentication required"});let{event:t}=e.query;if(!t)return i.status(400).json({images:[]});if(!process.env.GOOGLE_PROJECT_ID||!process.env.GOOGLE_PRIVATE_KEY||!process.env.GOOGLE_CLIENT_EMAIL)return console.error("Missing Google Drive environment variables"),i.status(500).json({error:"Google Drive configuration not found. Please set up environment variables.",images:[]});let n=Object.values(d).filter(e=>e&&"your-mehndi-folder-id"!==e&&"your-haldi-folder-id"!==e&&"your-dj-night-folder-id"!==e&&"your-wedding-folder-id"!==e);if(0===n.length)return console.warn("No Google Drive folder IDs configured"),i.status(200).json({images:[],message:"No folders configured yet. Please set up Google Drive folder IDs."});let o=s(),a="(mimeType contains 'image/' or mimeType contains 'video/') and trashed = false";if(t&&"all"!==t&&d[t]&&!1===d[t].startsWith("your-"))a+=` and '${d[t]}' in parents`;else{if("all"!==t)return i.status(200).json({images:[]});let e=Object.values(d).filter(e=>e&&!e.startsWith("your-"));e.length>0&&(a+=` and (${e.map(e=>`'${e}' in parents`).join(" or ")})`)}let u=await o.files.list({q:a,fields:"files(id, name, webViewLink, webContentLink, thumbnailLink, parents, description, createdTime, mimeType)",orderBy:"createdTime desc",pageSize:50}),extractUploaderFromFilename=e=>{let i=e.split("_");return i.length>=4?i[2].replace(/[_]/g," "):null},extractUploaderFromDescription=e=>{if(e&&e.includes("Uploaded by:")){let i=e.match(/Uploaded by: (.+?) on/);return i?i[1]:null}return null},m=(u.data.files||[]).map(e=>{let i;let r=extractUploaderFromFilename(e.name),t=extractUploaderFromDescription(e.description),n=e.mimeType.startsWith("video/");return i=n?e.thumbnailLink||`https://drive.google.com/thumbnail?id=${e.id}&sz=w400-h400`||`https://drive.google.com/file/d/${e.id}/view`:e.thumbnailLink||`https://drive.google.com/thumbnail?id=${e.id}&sz=w400-h400`,{id:e.id,url:i,fullUrl:`/api/image?fileId=${e.id}`,downloadUrl:e.webContentLink||`https://drive.google.com/uc?export=download&id=${e.id}`,name:e.name,uploader:t||r||"Unknown",uploadedAt:e.createdTime,isVideo:n,mimeType:e.mimeType,event:Object.keys(d).find(i=>e.parents?.includes(d[i]))||"",webViewLink:e.webViewLink,webContentLink:e.webContentLink,thumbnailLink:e.thumbnailLink}});i.status(200).json({images:m})}catch(e){console.error("Gallery API error:",e),i.status(500).json({error:"Failed to fetch images from Google Drive",images:[],details:e.message})}}let u=(0,a.l)(t,"default"),m=(0,a.l)(t,"config"),p=new n.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/gallery",pathname:"/api/gallery",bundlePath:"",filename:""},userland:t})}};var i=require("../../webpack-api-runtime.js");i.C(e);var __webpack_exec__=e=>i(i.s=e),r=i.X(0,[4222,9823,3545],()=>__webpack_exec__(5379));module.exports=r})();