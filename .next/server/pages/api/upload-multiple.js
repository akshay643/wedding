"use strict";(()=>{var e={};e.id=6261,e.ids=[6261],e.modules={9993:e=>{e.exports=require("googleapis")},9344:e=>{e.exports=require("jsonwebtoken")},1738:e=>{e.exports=require("multer")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2781:e=>{e.exports=require("stream")},8561:(e,r,o)=>{o.r(r),o.d(r,{config:()=>g,default:()=>m,routeModule:()=>h});var t={};o.r(t),o.d(t,{config:()=>f,default:()=>handler});var s=o(1802),i=o(7153),a=o(6249);let{initializeGoogleDrive:l}=o(3545),{uploadMultipleMiddleware:n,runMiddleware:d}=o(4755),{checkAuth:u}=o(9823),{Readable:p}=o(2781),f={api:{bodyParser:!1,responseLimit:!1}},c={mehndi:process.env.MEHNDI_FOLDER_ID||"your-mehndi-folder-id",haldi:process.env.HALDI_FOLDER_ID||"your-haldi-folder-id","dj-night":process.env.DJ_NIGHT_FOLDER_ID||"your-dj-night-folder-id",wedding:process.env.WEDDING_FOLDER_ID||"your-wedding-folder-id"};async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let{authenticated:o,user:t}=u(e);if(!o)return r.status(401).json({error:"Authentication required"});let s=t?.name||"Anonymous";try{if(await d(e,r,n),!e.files||0===e.files.length)return r.status(400).json({error:"No files uploaded"});let{event:o}=e.body;if(!o||!c[o])return r.status(400).json({error:"Invalid event specified"});let t=l(),i=[],a=[];for(let r=0;r<e.files.length;r++){let l=e.files[r];try{let a=p.from(l.buffer),n=new Date().toISOString().replace(/[:.]/g,"-"),d=s.replace(/[^a-zA-Z0-9]/g,"_"),u=`${o}_${n}_${d}_${r+1}_${l.originalname}`,f=await t.files.create({requestBody:{name:u,parents:[c[o]],description:`Uploaded by: ${s} on ${new Date().toLocaleString()} (File ${r+1} of ${e.files.length})`},media:{mimeType:l.mimetype,body:a}});await t.permissions.create({fileId:f.data.id,requestBody:{role:"reader",type:"anyone"}}),i.push({success:!0,fileId:f.data.id,filename:u,originalName:l.originalname,uploader:s,index:r+1})}catch(e){console.error(`Upload error for file ${r+1}:`,e),a.push({index:r+1,filename:l.originalname,error:e.message})}}let u=i.length,f=a.length,m=e.files.length;r.status(200).json({success:0===f,totalFiles:m,successCount:u,errorCount:f,uploadResults:i,errors:a,message:0===f?`All ${u} photos uploaded successfully!`:`${u} out of ${m} photos uploaded successfully. ${f} failed.`})}catch(e){console.error("Multiple upload error:",e),r.status(500).json({error:"Upload failed",details:e.message})}}let m=(0,a.l)(t,"default"),g=(0,a.l)(t,"config"),h=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/upload-multiple",pathname:"/api/upload-multiple",bundlePath:"",filename:""},userland:t})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[4222,9823,3545,4755],()=>__webpack_exec__(8561));module.exports=o})();