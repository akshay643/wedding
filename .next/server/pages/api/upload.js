"use strict";(()=>{var e={};e.id=5039,e.ids=[5039],e.modules={9993:e=>{e.exports=require("googleapis")},9344:e=>{e.exports=require("jsonwebtoken")},1738:e=>{e.exports=require("multer")},145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2781:e=>{e.exports=require("stream")},8677:(e,r,o)=>{o.r(r),o.d(r,{config:()=>_,default:()=>m,routeModule:()=>g});var i={};o.r(i),o.d(i,{config:()=>c,default:()=>handler});var s=o(1802),t=o(7153),a=o(6249);let{initializeGoogleDrive:n}=o(3545),{uploadMiddleware:d,runMiddleware:l}=o(4755),{checkAuth:u}=o(9823),{Readable:p}=o(2781),c={api:{bodyParser:!1,responseLimit:!1}},f={mehndi:process.env.MEHNDI_FOLDER_ID||"your-mehndi-folder-id",haldi:process.env.HALDI_FOLDER_ID||"your-haldi-folder-id","dj-night":process.env.DJ_NIGHT_FOLDER_ID||"your-dj-night-folder-id",wedding:process.env.WEDDING_FOLDER_ID||"your-wedding-folder-id"};async function handler(e,r){if("POST"!==e.method)return r.status(405).json({error:"Method not allowed"});let{authenticated:o,user:i}=u(e);if(!o)return r.status(401).json({error:"Authentication required"});let s=i?.name||"Anonymous";if(!process.env.GOOGLE_PROJECT_ID||!process.env.GOOGLE_PRIVATE_KEY||!process.env.GOOGLE_CLIENT_EMAIL||"your-project-id"===process.env.GOOGLE_PROJECT_ID)return r.status(500).json({error:"Google Drive not configured",message:"Please set up Google Drive credentials in .env file"});try{if(await l(e,r,d),!e.file)return r.status(400).json({error:"No file uploaded"});console.log("Upload API - File received:",{originalname:e.file.originalname,mimetype:e.file.mimetype,size:e.file.size,sizeMB:(e.file.size/1048576).toFixed(1)+"MB"});let{event:o}=e.body;if(!o||!f[o])return r.status(400).json({error:"Invalid event specified"});let i=f[o];if(!i||i.startsWith("your-"))return r.status(500).json({error:"Folder not configured",message:`Please set up ${o.toUpperCase()}_FOLDER_ID in .env file`});let t=n(),a=p.from(e.file.buffer),u=new Date().toISOString().replace(/[:.]/g,"-"),c=s.replace(/[^a-zA-Z0-9]/g,"_"),m=`${o}_${u}_${c}_${e.file.originalname}`,_=await t.files.create({requestBody:{name:m,parents:[f[o]],description:`Uploaded by: ${s} on ${new Date().toLocaleString()}`},media:{mimeType:e.file.mimetype,body:a}});await t.permissions.create({fileId:_.data.id,requestBody:{role:"reader",type:"anyone"}});let g=`https://drive.google.com/uc?id=${_.data.id}`;r.status(200).json({success:!0,fileId:_.data.id,filename:m,uploader:s,imageUrl:g,message:`Photo uploaded successfully by ${s}!`})}catch(e){console.error("Upload error:",e),r.status(500).json({error:"Upload failed",details:e.message})}}let m=(0,a.l)(i,"default"),_=(0,a.l)(i,"config"),g=new s.PagesAPIRouteModule({definition:{kind:t.x.PAGES_API,page:"/api/upload",pathname:"/api/upload",bundlePath:"",filename:""},userland:i})}};var r=require("../../webpack-api-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),o=r.X(0,[4222,9823,3545,4755],()=>__webpack_exec__(8677));module.exports=o})();